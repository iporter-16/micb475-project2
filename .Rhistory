gg_pcoa
gg_pcoa_LDL <- plot_ordination(phyloseq_object_final, pcoa_bc, color = "smoker", shape="LDL_category") +
labs(pch="LDL level", col = "smoking status")
gg_pcoa_LDL
gg_pcoa_fibre <- plot_ordination(phyloseq_object_final, pcoa_bc, color = "smoker", shape="fibre_category") +
labs(pch="fibre level", col = "smoking status")
gg_pcoa_fibre
gg_pcoa_LDL
gg_pcoa_fibre
gg_pcoa_LDL
gg_pcoa_fibre
gg_pcoa_LDL
gg_pcoa_fibre
gg_pcoa_LDL
gg_pcoa_fibre
gg_pcoa_LDL
# Save plots
ggsave("plot_pcoa_fibre.png"
, gg_pcoa_fibre
, height=4, width=5)
ggsave("plot_pcoa_LDL.png"
, gg_pcoa_LDL
, height=4, width=5)
plot_ordination(phyloseq_object_final, pcoa_bc, color = "fibre_category", shape="smoker")
plot_ordination(phyloseq_object_final, pcoa_bc, color = "LDL_category", shape="smoker")
plot_ordination(phyloseq_object_final, pcoa_bc, color = "LDL_category", shape="smoker")
plot_ordination(phyloseq_object_final, pcoa_bc, color = "fibre_category", shape="smoker")
plot_ordination(phyloseq_object_final, pcoa_bc, color = "fibre_category", shape="smoker")
plot_ordination(phyloseq_object_final, pcoa_bc, color = "LDL_category", shape="smoker")
gg_pcoa_fibre <- plot_ordination(phyloseq_object_final, pcoa_bc, color = "fibre_category", shape="smoker") +
labs(pch="smoking status", col = "fibre level")
gg_pcoa_fibre
plot_ordination(phyloseq_object_final, pcoa_bc, color = "fibre_category", shape="smoker")
gg_pcoa_fibre <- plot_ordination(phyloseq_object_final, pcoa_bc, color = "fibre_category", shape="smoker") +
labs(pch="smoking status", col = "fibre level")
gg_pcoa_fibre
gg_pcoa_LDL <- plot_ordination(phyloseq_object_final, pcoa_bc, color = "LDL_category", shape="smoker") +
labs(pch="smoking status", col = "LDL level")
gg_pcoa_LDL
# Save plots
ggsave("plot_pcoa_fibre.png"
, gg_pcoa_fibre
, height=4, width=5)
ggsave("plot_pcoa_LDL.png"
, gg_pcoa_LDL
, height=4, width=5)
#load libraries
library(phyloseq)
library(ape)
library(tidyverse)
library(vegan)
#load data
metafp <- "colombia/metadata_categorized_CL.txt"
meta <- read_delim(metafp, delim="\t")
meta
otufp <- "colombia/colombia_export/table_export/feature-table.txt"
otu <- read_delim(file = otufp, delim="\t", skip=1)
taxfp <- "colombia/colombia_export/taxonomy_export/taxonomy.tsv"
tax <- read_delim(taxfp, delim="\t")
phylotreefp <- "colombia/colombia_export/rooted_tree_export/tree.nwk"
phylotree <- read.tree(phylotreefp)
otu_mat <- as.matrix(otu[,-1])
rownames(otu_mat) <- otu$`#OTU ID`
OTU <- otu_table(otu_mat, taxa_are_rows = TRUE)
class(OTU)
### Format updated metadata ###
samp_df <- as.data.frame(meta[,-1])
rownames(samp_df)<- meta$'#SampleID'
SAMP <- sample_data(samp_df)
class(SAMP)
### Formatting taxonomy ###
tax_mat <- tax %>% select(-Confidence)%>%
separate(col=Taxon, sep="; "
, into = c("Domain","Phylum","Class","Order","Family","Genus","Species")) %>%
as.matrix()
tax_mat <- tax_mat[,-1]
rownames(tax_mat) <- tax$`Feature ID`
TAX <- tax_table(tax_mat)
class(TAX)
### Create phyloseq object ###
colombia <- phyloseq(OTU, SAMP, TAX, phylotree)
### Looking at phyloseq object ####
otu_table(colombia)
sample_data(colombia)
tax_table(colombia)
phy_tree(colombia)
### Filter out non-bacterial sequences ###
colombia_filt <- subset_taxa(colombia, Domain == "d__Bacteria" & Class!="c__Chloroplast" & Family !="f__Mitochondria")
### Pruning samples with less than 100 reads ###
colombia_filt_samps <- prune_samples(sample_sums(colombia_filt)>100, colombia_filt)
### Rarefy ###
phyloseq_object_final <- rarefy_even_depth(colombia_filt_samps, rngseed = 1, sample.size = 22700)
### Save ###
save(colombia_filt_samps, file="colombia_filt_samps.RData")
save(phyloseq_object_final, file="phyloseq_object_final.RData")
# Load packages
library(vegan)
library(phyloseq)
library(tidyverse)
# Load phyloseq object
load("phyloseq_object_final.RData")
# PCoA Plot
bc_dm <- distance(phyloseq_object_final, method="bray")
pcoa_bc <- ordinate(phyloseq_object_final, method="PCoA", distance=bc_dm)
plot_ordination(phyloseq_object_final, pcoa_bc, color = "fibre_category", shape="smoker")
getwd()
abundance_file <- "picrust_processing/picrust2_out_pipeline/pathways_out/path_abun_unstrat.tsv"
abundance_data <- read_delim(abundance_file, delim = "\t", col_names = TRUE, trim_ws = TRUE)
library(readr)
library(ggpicrust2)
library(tibble)
library(tidyverse)
library(ggprism)
library(patchwork)
abundance_file <- "picrust_processing/picrust2_out_pipeline/pathways_out/path_abun_unstrat.tsv"
abundance_data <- read_delim(abundance_file, delim = "\t", col_names = TRUE, trim_ws = TRUE)
abundance_data  =as.data.frame(abundance_data)
rownames(abundance_data) = abundance_data$pathway
abundance_data = abundance_data[,-1]
metadata <- read_delim("colombia/metadata_categorized_CL.txt",
delim = "\t",escape_double = FALSE,trim_ws = TRUE)
metadata_smoking <- filter(metadata, metadata$smoker=="Yes")
metadata_nonsmoking <- filter(metadata, metadata$smoker=="No")
results_smoking_fiber_input <- ggpicrust2(file = abundance_file, metadata = metadata_smoking,
group = "fibre_category", pathway = "MetaCyc",daa_method = "LinDA",
ko_to_kegg = FALSE,order = "pathway_class",p_values_bar = TRUE,x_lab = "pathway_name")
results_smoking_fiber_input <- ggpicrust2(file = abundance_file, metadata = metadata,
group = "fibre_category", pathway = "MetaCyc",daa_method = "LinDA",
ko_to_kegg = FALSE,order = "pathway_class",p_values_bar = TRUE,x_lab = "pathway_name")
View(abundance_data)
View(metadata)
?select
?is.in
abundance_data_smoking <- intersect(colnames(abundance_data),rownames(metadata_smoking))_
?intersect
abundance_data_smoking <- select(abundance_data, rownames(metadata_smoking))
rownames(metadata_smoking)
abundance_data_smoking <- select(abundance_data, metadata_smoking$`#SampleID`)
View(abundance_data_smoking)
abundance_data_smoking <- select(abundance_data, metadata_smoking$`#SampleID`)
abundance_data_nonsmoking <- select(abundance_data, metadata_nonsmoking$`#SampleID`)
?ggpicrust2
results_smoking_fiber_input <- ggpicrust2(data = abundance_data_smoking, metadata = metadata_smoking,
group = "fibre_category", pathway = "MetaCyc",daa_method = "LinDA",
ko_to_kegg = FALSE,order = "pathway_class",p_values_bar = TRUE,x_lab = "pathway_name")
View(abundance_data_smoking)
colnames(abundance_data_smoking)
unique(colnames(abundance_data_smoking))
metadata_smoking$`#SampleID`
results_smoking_fiber_input <- ggpicrust2(data = abundance_data_smoking, metadata = metadata_smoking,
group = "fibre_category", pathway = "MetaCyc",daa_method = "LinDA",
ko_to_kegg = FALSE,order = "pathway_class",p_values_bar = TRUE,x_lab = "pathway_name")
= abundance_file, metadata = metadata,
results_smoking_fiber_input <- ggpicrust2(file = abundance_file, metadata = metadata,
group = "fibre_category", pathway = "MetaCyc",daa_method = "LinDA",
ko_to_kegg = FALSE,order = "pathway_class",p_values_bar = TRUE,x_lab = "pathway_name")
results_smoking_fiber_input
results_smoking_fiber_input <- ggpicrust2(file = abundance_file, metadata = metadata,
group = "fibre_category", pathway = "MetaCyc",daa_method = "LinDA",
ko_to_kegg = FALSE,order = "pathway_class",p_values_bar = TRUE,x_lab = "pathway_name")
results_smoking_fiber_input
ggpicrust2(file = abundance_file, metadata = metadata,
group = "fibre_category", pathway = "MetaCyc",daa_method = "LinDA",
ko_to_kegg = FALSE,order = "pathway_class",p_values_bar = TRUE,x_lab = "pathway_name")
View(metadata)
getwd()
write.table(metadata_smoking,file="picrust_processing/imogen_picrust_tests/metadata_smoking.tsv",row.names=FALSE,sep="\t")
write.table(metadata_smoking,file="picrust_processing/imogen_picrust_tests/metadata_smoking.tsv",row.names=FALSE,sep="\t")
write.table(metadata_nonsmoking,file="picrust_processing/imogen_picrust_tests/metadata_nonsmoking.tsv",row.names=FALSE,sep="\t")
write.table(abundance_data_smoking,file="picrust_processing/imogen_picrust_tests/abundance_smoking.tsv",row.names=FALSE,sep="\t")
write.table(abundance_data_nonsmoking,file="picrust_processing/imogen_picrust_tests/abundance_nonmoking.tsv",row.names=FALSE,sep="\t")
results_smoking_fiber_input <- ggpicrust2(data = abundance_data_smoking, metadata = metadata_smoking,
group = "fibre_category", pathway = "MetaCyc",daa_method = "LinDA",
ko_to_kegg = FALSE,order = "pathway_class",p_values_bar = TRUE,x_lab = "pathway_name")
abundance_data
abundance_data_smoking
View(abundance_data)
View(abundance_data_nonsmoking)
results_smoking_fiber_input <- ggpicrust2(file = "picrust_processing/imogen_picrust_tests/abundance_smoking.tsv", metadata = metadata_smoking,
group = "fibre_category", pathway = "MetaCyc",daa_method = "LinDA",
ko_to_kegg = FALSE,order = "pathway_class",p_values_bar = TRUE,x_lab = "pathway_name")
library("ggh4x")
data("metadata")
View(metadata)
#read metadata
metadata <- read_delim("colombia/metadata_categorized_CL.txt",
delim = "\t",escape_double = FALSE,trim_ws = TRUE)
results_smoking_fiber_input <- ggpicrust2(data=abundance_data_smoking, metadata = metadata_smoking,
group = "fibre_category", pathway = "KO",daa_method = "LinDA",
ko_to_kegg = FALSE,order = "pathway_class",p_values_bar = TRUE,x_lab = "pathway_name")
rownames(abundance_data)
rownames(abundance_data_smoking)
count(rownames(abundance_data_smoking))
length(rownames(abundance_data_smoking))
length(unique(rownames(abundance_data_smoking))
)
length(unique(rownames(metadata_smoking)))
length((rownames(metadata_smoking))
)
results_smoking_fiber_input <- ggpicrust2(data=abundance_data_smoking, metadata = metadata_smoking,
group = "fibre_category", pathway = "KO",daa_method = "LinDA",
ko_to_kegg = FALSE,order = "pathway_class",p_values_bar = TRUE,x_lab = "pathway_name")
row.names(abundance_data_smoking)
# Perform pathway differential abundance analysis (DAA) using ALDEx2 method
# Please change group to "your_group_column" if you are not using example dataset
daa_results_df_smoking <- pathway_daa(abundance = abundance_data_smoking, metadata = metadata_smoking, group = "fibre_category", daa_method = "LinDA", select = NULL, reference = NULL)
daa_results_df_smoking
daa_results_annotated_df_smoking <- pathway_annotation(pathway = "KO", daa_results_df = daa_results_df_smoking,
ko_to_kegg = FALSE)
daa_results_annotated_df_smoking
pathway_errorbar(abundance = abundance_data_smoking %>% column_to_rownames("pathway"), daa_results_df = metacyc_daa_annotated_results_df,
Group = metadata$fibre_category, ko_to_kegg = FALSE, p_values_threshold = 0.05, order = "group",
select = NULL, p_value_bar = TRUE, colors = NULL, x_lab = "description")
pathway_errorbar(abundance = abundance_data_smoking %>% column_to_rownames("pathway"), daa_results_df = daa_results_annotated_df_smoking,
Group = metadata$fibre_category, ko_to_kegg = FALSE, p_values_threshold = 0.05, order = "group",
select = NULL, p_value_bar = TRUE, colors = NULL, x_lab = "description")
metadata$fibre_category
unique(metadata$fibre_category)
daa_results_annotated_df_smoking <- pathway_annotation(pathway = "KO", daa_results_df = daa_results_df_smoking,
ko_to_kegg = TRUE)
daa_results_annotated_df_smoking <- pathway_annotation(pathway = "MetaCyc", daa_results_df = daa_results_df_smoking,
ko_to_kegg = FALSE)
daa_results_annotated_df_smoking <- pathway_annotation(pathway = "KO", daa_results_df = daa_results_df_smoking,
ko_to_kegg = FALSE)
View(abundance_data_smoking)
feature_with_p_0.05 <- daa_results_df_smoking %>% filter(p_adjust < 0.05)
pathway_heatmap(abundance = abundance_data_smoking %>% filter(pathway %in% feature_with_p_0.05$feature) %>% column_to_rownames("pathway"), metadata = metadata, group = "fibre_category")
pathway_heatmap(abundance = abundance_data_smoking %>% filter(ARGDEG-PWY %in% feature_with_p_0.05$feature) %>% column_to_rownames("pathway"), metadata = metadata, group = "fibre_category")
data("test_abundance")
# Load the metadata
data("test_metadata")
library(tidyverse)
library(ggh4x)
library(ggpicrust2)
data("test_abundance")
# Load the metadata
data("test_metadata")data("metacyc_abundance")
data("metacyc_abundance")
# Load the metadata
data("metadata")
metadata
View(metadata)
metacyc_abundance
View(metacyc_abundance)
View(abundance_data_nonsmoking)
abundance_data <- read_delim(abundance_file, delim = "\t", col_names = TRUE, trim_ws = TRUE)
View(abundance_data)
abundance_data <- read_delim(abundance_file, delim = "\t", col_names = TRUE, trim_ws = TRUE)
abundance_data  =as.data.frame(abundance_data)
metadata_smoking <- filter(metadata, metadata$smoker=="Yes")
metadata <- read_delim("colombia/metadata_categorized_CL.txt",
delim = "\t",escape_double = FALSE,trim_ws = TRUE)
metadata_smoking <- filter(metadata, metadata$smoker=="Yes")
metadata_nonsmoking <- filter(metadata, metadata$smoker=="No")
abundance_data_smoking <- select(abundance_data, metadata_smoking$`#SampleID`)
abundance_data_nonsmoking <- select(abundance_data, metadata_nonsmoking$`#SampleID`)
write.table(metadata_smoking,file="picrust_processing/imogen_picrust_tests/metadata_smoking.tsv",row.names=FALSE,sep="\t")
write.table(metadata_nonsmoking,file="picrust_processing/imogen_picrust_tests/metadata_nonsmoking.tsv",row.names=FALSE,sep="\t")
write.table(abundance_data_smoking,file="picrust_processing/imogen_picrust_tests/abundance_smoking.tsv",row.names=FALSE,sep="\t")
write.table(abundance_data_nonsmoking,file="picrust_processing/imogen_picrust_tests/abundance_nonmoking.tsv",row.names=FALSE,sep="\t")
results_smoking_fiber_input <- ggpicrust2(data=abundance_data_smoking, metadata = metadata_smoking,
group = "fibre_category", pathway = "KO",daa_method = "LinDA",
ko_to_kegg = FALSE,order = "pathway_class",p_values_bar = TRUE,x_lab = "pathway_name")
daa_results_df_smoking <- pathway_daa(abundance = abundance_data_smoking, metadata = metadata_smoking,
group = "fibre_category", daa_method = "LinDA", select = NULL, reference = NULL)
sults_annotated_df_smoking <- pathway_annotation(pathway = "KO", daa_results_df = daa_results_df_smoking,
ko_to_kegg = FALSE)
View(daa_results_df_smoking)
P <- pathway_errorbar(abundance = abundance_data_smoking %>% column_to_rownames("pathway"), daa_results_df = daa_results_annotated_df_smoking,
Group = metadata$fibre_category, ko_to_kegg = FALSE, p_values_threshold = 0.05, order = "group",
select = NULL, p_value_bar = TRUE, colors = NULL, x_lab = "description")
View(abundance_data_smoking)
view(abundance_data)
rm(abundance_data_nonsmoking)
abundance_data_nonsmoking <- select(abundance_data, metadata_nonsmoking$`#SampleID`)
View(abundance_data_nonsmoking)
View(metadata)
View(metadata_nonsmoking)
abundance_data_smoking <- abundance_data %>%
rownames_to_column('pathway') %>%
select(metadata_smoking$`#SampleID`) %>%
column_to_rownames('pathway')
View(abundance_data_nonsmoking)
abundance_data_smoking <- cbind(abundance_data$pathway,select(abundance_data, metadata_smoking$`#SampleID`))
View(abundance_data_smoking)
abundance_data_smoking <- cbind(abundance_data$pathway,select(abundance_data, metadata_smoking$`#SampleID`))
abundance_data_nonsmoking <- cbind(abundance_data$pathway,select(abundance_data, metadata_nonsmoking$`#SampleID`))
names(abundance_data_smoking)[names(abundance_data_smoking) == 'abundance_data$pathway'] <- 'pathway'
names(abundance_data_nonsmoking)[names(abundance_data_nonsmoking) == 'abundance_data$pathway'] <- 'pathway'
View(abundance_data_nonsmoking)
write.table(metadata_smoking,file="picrust_processing/imogen_picrust_tests/metadata_smoking.tsv",row.names=FALSE,sep="\t")
write.table(metadata_nonsmoking,file="picrust_processing/imogen_picrust_tests/metadata_nonsmoking.tsv",row.names=FALSE,sep="\t")
write.table(abundance_data_smoking,file="picrust_processing/imogen_picrust_tests/abundance_smoking.tsv",row.names=FALSE,sep="\t")
writ
write.table(abundance_data_nonsmoking,file="picrust_processing/imogen_picrust_tests/abundance_nonmoking.tsv",row.names=FALSE,sep="\t")
results_smoking_fiber_input <- ggpicrust2(data=abundance_data_smoking, metadata = metadata_smoking,
group = "fibre_category", pathway = "KO",daa_method = "LinDA",
ko_to_kegg = FALSE,order = "pathway_class",p_values_bar = TRUE,x_lab = "pathway_name")
results_smoking_fiber_input
daa_results_df_smoking <- pathway_daa(abundance = abundance_data_smoking, metadata = metadata_smoking,
group = "fibre_category", daa_method = "LinDA", select = NULL, reference = NULL)
# Please change Group to metadata$your_group_column if you are not using example dataset
P <- pathway_errorbar(abundance = abundance_data_smoking %>% column_to_rownames("pathway"), daa_results_df = daa_results_annotated_df_smoking,
Group = metadata$fibre_category, ko_to_kegg = FALSE, p_values_threshold = 0.05, order = "group",
select = NULL, p_value_bar = TRUE, colors = NULL, x_lab = "description")
view(daa_results_df_smoking)
unique(daa_results_df_smoking$method)
P <- pathway_errorbar(abundance = abundance_data_smoking %>%  daa_results_df = daa_results_annotated_df_smoking,
P <- pathway_errorbar(abundance = abundance_data_smoking, daa_results_df = daa_results_annotated_df_smoking,
Group = metadata$fibre_category, ko_to_kegg = FALSE, p_values_threshold = 0.05, order = "fibre_category",
select = NULL, p_value_bar = TRUE, colors = NULL, x_lab = "description")
view(abundance_data_smoking)
unique(daa_results_df_smoking$adj_method)
pathway_heatmap(abundance = abundance_data_smoking %>% filter(pathway %in% feature_with_p_0.05$feature) %>% column_to_rownames("pathway"), metadata = metadata, group = "fibre_category")
# Generate pathway heatmap
# Please change column_to_rownames() to the feature column if you are not using example dataset
# Please change group to "your_group_column" if you are not using example dataset
feature_with_p_0.05 <- daa_results_df_smoking %>% filter(p_adjust < 0.05)
pathway_heatmap(abundance = abundance_data_smoking %>% filter(pathway %in% feature_with_p_0.05$feature) %>% column_to_rownames("pathway"), metadata = metadata, group = "fibre_category")
# Generate pathway PCA plot
# Please change column_to_rownames() to the feature column if you are not using example dataset
# Please change group to "your_group_column" if you are not using example dataset
pathway_pca(abundance = abundance_data_smoking %>% column_to_rownames("pathway"), metadata = metadata_smoking, group = "fibre_category")
daa_results_df_smoking <- pathway_daa(abundance = abundance_data_smoking, metadata = metadata_smoking,
group = "fibre_category", daa_method = "LinDA", select = NULL, reference = NULL)
view(metadata_smoking)
rlang::last_trace()
daa_results_df <- pathway_daa(abundance = abundance_data, metadata = metadata,
group = "fibre_category", daa_method = "LinDA", select = NULL, reference = NULL)
abundance_file <- "picrust_processing/picrust2_out_pipeline/pathways_out/path_abun_unstrat.tsv"
abundance_data <- read_delim(abundance_file, delim = "\t", col_names = TRUE, trim_ws = TRUE)
abundance_data  =as.data.frame(abundance_data)
rownames(abundance_data) = abundance_data$pathway
abundance_data = abundance_data[,-1]
daa_results_df <- pathway_daa(abundance = abundance_data, metadata = metadata,
group = "fibre_category", daa_method = "LinDA", select = NULL, reference = NULL)
names(abundance_data_smoking)[names(abundance_data_smoking) == 'abundance_data$pathway'] <- 'pathway'
names(abundance_data_nonsmoking)[names(abundance_data_nonsmoking) == 'abundance_data$pathway'] <- 'pathway'
# Generate pathway heatmap
# Please change column_to_rownames() to the feature column if you are not using example dataset
# Please change group to "your_group_column" if you are not using example dataset
feature_with_p_0.05 <- daa_results_df_smoking %>% filter(p_adjust < 0.05)
pathway_heatmap(abundance = abundance_data_smoking %>% filter(pathway %in% feature_with_p_0.05$feature) %>% column_to_rownames("pathway"), metadata = metadata, group = "fibre_category")
View(daa_results_df)
daa_results_df <- pathway_daa(abundance = abundance_data, metadata = metadata,
group = "fibre_category", daa_method = "LinDA", select = NULL, reference = NULL)
daa_results_df_smoking <- pathway_daa(abundance = abundance_data_smoking, metadata = metadata_smoking,
group = "fibre_category", daa_method = "LinDA", select = NULL, reference = NULL)
View(daa_results_df)
abundance_file <- "picrust_processing/picrust2_out_pipeline/pathways_out/path_abun_unstrat.tsv"
abundance_data <- read_delim(abundance_file, delim = "\t", col_names = TRUE, trim_ws = TRUE)
abundance_data  =as.data.frame(abundance_data)
rownames(abundance_data) = abundance_data$pathway
abundance_data = abundance_data[,-1]
#read metadata
metadata <- read_delim("colombia/metadata_categorized_CL.txt",
delim = "\t",escape_double = FALSE,trim_ws = TRUE)
#isolate smoking and nonsmoking from abundance data and metadata
metadata_smoking <- filter(metadata, metadata$smoker=="Yes")
metadata_nonsmoking <- filter(metadata, metadata$smoker=="No")
abundance_data_smoking <- cbind(abundance_data$pathway,select(abundance_data, metadata_smoking$`#SampleID`))
abundance_data_smoking <- cbind(abundance_data$pathway,select(abundance_data, metadata_smoking$`#SampleID`))
View(abundance_data)
abundance_file <- "picrust_processing/picrust2_out_pipeline/pathways_out/path_abun_unstrat.tsv"
abundance_data <- read_delim(abundance_file, delim = "\t", col_names = TRUE, trim_ws = TRUE)
abundance_data  =as.data.frame(abundance_data)
# rownames(abundance_data) = abundance_data$pathway
# abundance_data = abundance_data[,-1]
#read metadata
metadata <- read_delim("colombia/metadata_categorized_CL.txt",
delim = "\t",escape_double = FALSE,trim_ws = TRUE)
#isolate smoking and nonsmoking from abundance data and metadata
metadata_smoking <- filter(metadata, metadata$smoker=="Yes")
metadata_nonsmoking <- filter(metadata, metadata$smoker=="No")
abundance_data_smoking <- cbind(abundance_data$pathway,select(abundance_data, metadata_smoking$`#SampleID`))
abundance_data_nonsmoking <- cbind(abundance_data$pathway,select(abundance_data, metadata_nonsmoking$`#SampleID`))
names(abundance_data_smoking)[names(abundance_data_smoking) == 'abundance_data$pathway'] <- 'pathway'
names(abundance_data_nonsmoking)[names(abundance_data_nonsmoking) == 'abundance_data$pathway'] <- 'pathway'
daa_results_df <- pathway_daa(abundance = abundance_data, metadata = metadata,
group = "fibre_category", daa_method = "LinDA", select = NULL, reference = NULL)
daa_results_df <- pathway_daa(abundance = abundance_data, metadata = metadata,
group = "fibre_category", daa_method = "LinDA", select = NULL, reference = NULL)
rownames(abundance_data) = abundance_data$pathway
abundance_data = abundance_data[,-1]
daa_results_df <- pathway_daa(abundance = abundance_data, metadata = metadata,
group = "fibre_category", daa_method = "LinDA", select = NULL, reference = NULL)
View(abundance_data)
daa_results_df_smoking <- pathway_daa(abundance = abundance_data_smoking, metadata = metadata_smoking,
group = "fibre_category", daa_method = "LinDA", select = NULL, reference = NULL)
abundance_data_smoking <- select(abundance_data, metadata_smoking$`#SampleID`)
abundance_data_nonsmoking <- select(abundance_data, metadata_nonsmoking$`#SampleID`)
daa_results_df_smoking <- pathway_daa(abundance = abundance_data_smoking, metadata = metadata_smoking,
group = "fibre_category", daa_method = "LinDA", select = NULL, reference = NULL)
daa_results_df_nonsmoking <- pathway_daa(abundance = abundance_data_nonsmoking, metadata = metadata_nonsmoking,
group = "fibre_category", daa_method = "LinDA", select = NULL, reference = NULL)
# Generate pathway heatmap
# Please change column_to_rownames() to the feature column if you are not using example dataset
# Please change group to "your_group_column" if you are not using example dataset
feature_with_p_0.05 <- daa_results_df_smoking %>% filter(p_adjust < 0.05)
pathway_heatmap(abundance = abundance_data_smoking %>% filter(pathway %in% feature_with_p_0.05$feature) %>% column_to_rownames("pathway"), metadata = metadata, group = "fibre_category")
feature_with_p_0.05
daa_results_df_smoking
view(daa_results_df_smoking)
view(daa_results_df_nonsmoking)
# Generate pathway heatmap
# Please change column_to_rownames() to the feature column if you are not using example dataset
# Please change group to "your_group_column" if you are not using example dataset
feature_with_p_0.05 <- daa_results_df_nonsmoking %>% filter(p_adjust < 0.1)
pathway_heatmap(abundance = abundance_data_smoking %>% filter(pathway %in% feature_with_p_0.05$feature) %>% column_to_rownames("pathway"), metadata = metadata, group = "fibre_category")
feature_with_p_0.05
pathway_heatmap(abundance = abundance_data_smoking %>% filter(feature %in% feature_with_p_0.05$feature) %>% column_to_rownames("pathway"), metadata = metadata, group = "fibre_category")
pathway_heatmap(abundance = abundance_data_smoking %>% filter(P23-PWY %in% feature_with_p_0.05$feature) %>% column_to_rownames("pathway"), metadata = metadata, group = "fibre_category")
pathway_heatmap(abundance = abundance_data_smoking %>% filter("P23-PWY" %in% feature_with_p_0.05$feature) %>% column_to_rownames("pathway"), metadata = metadata, group = "fibre_category")
abundance_data <- read_delim(abundance_file, delim = "\t", col_names = TRUE, trim_ws = TRUE)
abundance_data  =as.data.frame(abundance_data)
view(abundance_data)
rownames(abundance_data) = abundance_data$pathway
abundance_data = abundance_data[,-1]
abundance_data <- read_delim(abundance_file, delim = "\t", col_names = TRUE, trim_ws = TRUE)
abundance_data  =as.data.frame(abundance_data)
rownames(abundance_data) = abundance_data$pathway
abundance_data = abundance_data[,-1]
view(abundance_data)
abundance_data_smoking <- select(abundance_data, metadata_smoking$`#SampleID`)
abundance_data_nonsmoking <- select(abundance_data, metadata_nonsmoking$`#SampleID`)
daa_results_df <- pathway_daa(abundance = abundance_data, metadata = metadata,
group = "fibre_category", daa_method = "LinDA", select = NULL, reference = NULL)
daa_results_df
daa_results_df_smoking <- pathway_daa(abundance = abundance_data_smoking, metadata = metadata_smoking,
group = "fibre_category", daa_method = "LinDA", select = NULL, reference = NULL)
daa_results_df_nonsmoking <- pathway_daa(abundance = abundance_data_nonsmoking, metadata = metadata_nonsmoking,
group = "fibre_category", daa_method = "LinDA", select = NULL, reference = NULL)
# Generate pathway heatmap
# Please change column_to_rownames() to the feature column if you are not using example dataset
# Please change group to "your_group_column" if you are not using example dataset
feature_with_p_0.05 <- daa_results_df_nonsmoking %>% filter(p_adjust < 0.1)
pathway_heatmap(abundance = abundance_data_smoking %>% filter(P23-PWY %in% feature_with_p_0.05$feature) %>% column_to_rownames("pathway"), metadata = metadata, group = "fibre_category")
pathway_heatmap(abundance = abundance_data_smoking %>% filter(pathway %in% feature_with_p_0.05$feature) %>% column_to_rownames("pathway"), metadata = metadata, group = "fibre_category")
#read abundance data
abundance_file <- "picrust_processing/picrust2_out_pipeline/pathways_out/path_abun_unstrat.tsv"
abundance_data <- read_delim(abundance_file, delim = "\t", col_names = TRUE, trim_ws = TRUE)
abundance_data  =as.data.frame(abundance_data)
#change pathways from a column to rownames, required for pathway_daa() function
rownames(abundance_data) = abundance_data$pathway
abundance_data = abundance_data[,-1]
#read metadata
metadata <- read_delim("colombia/metadata_categorized_CL.txt",
delim = "\t",escape_double = FALSE,trim_ws = TRUE)
#isolate smoking and nonsmoking from abundance data and metadata
metadata_smoking <- filter(metadata, metadata$smoker=="Yes")
metadata_nonsmoking <- filter(metadata, metadata$smoker=="No")
abundance_data_smoking <- select(abundance_data, metadata_smoking$`#SampleID`)
abundance_data_nonsmoking <- select(abundance_data, metadata_nonsmoking$`#SampleID`)
# abundance_data_smoking <- cbind(abundance_data$pathway,select(abundance_data, metadata_smoking$`#SampleID`))
# abundance_data_nonsmoking <- cbind(abundance_data$pathway,select(abundance_data, metadata_nonsmoking$`#SampleID`))
# names(abundance_data_smoking)[names(abundance_data_smoking) == 'abundance_data$pathway'] <- 'pathway'
# names(abundance_data_nonsmoking)[names(abundance_data_nonsmoking) == 'abundance_data$pathway'] <- 'pathway'
# Perform pathway differential abundance analysis (DAA) using LinDA
# Please change group to "your_group_column" if you are not using example dataset
daa_results_df <- pathway_daa(abundance = abundance_data, metadata = metadata,
group = "fibre_category", daa_method = "LinDA", select = NULL, reference = NULL)
daa_results_df_smoking <- pathway_daa(abundance = abundance_data_smoking, metadata = metadata_smoking,
group = "fibre_category", daa_method = "LinDA", select = NULL, reference = NULL)
daa_results_df_nonsmoking <- pathway_daa(abundance = abundance_data_nonsmoking, metadata = metadata_nonsmoking,
group = "fibre_category", daa_method = "LinDA", select = NULL, reference = NULL)
feature_with_p_0.05
# Generate pathway heatmap
# Please change column_to_rownames() to the feature column if you are not using example dataset
# Please change group to "your_group_column" if you are not using example dataset
feature_with_p_0.05 <- daa_results_df_nonsmoking %>% filter(p_adjust < 0.1)
# Generate pathway heatmap
# Please change column_to_rownames() to the feature column if you are not using example dataset
# Please change group to "your_group_column" if you are not using example dataset
feature_with_p_0.1 <- daa_results_df_nonsmoking %>% filter(p_adjust < 0.1)
feature_with_p_0.1
pathway_heatmap(abundance = abundance_data_smoking %>% filter(PWY %in% feature_with_p_0.05$feature) %>% column_to_rownames("pathway"), metadata = metadata, group = "fibre_category")
feature_with_p_0.05$feature
pathway_heatmap(abundance = abundance_data_smoking %>% filter("PWY" %in% feature_with_p_0.05$feature) %>% column_to_rownames("pathway"), metadata = metadata, group = "fibre_category")
feature_with_p_0.05
abundance_data_smoking
VIEW(abundance_data_smoking)
view(abundance_data_smoking)
abundance_file <- "picrust_processing/picrust2_out_pipeline/pathways_out/path_abun_unstrat.tsv"
abundance_data <- read_delim(abundance_file, delim = "\t", col_names = TRUE, trim_ws = TRUE)
abundance_data  =as.data.frame(abundance_data)
#change pathways from a column to rownames, required for pathway_daa() function
rownames(abundance_data) = abundance_data$pathway
abundance_data = abundance_data[,-1]
#read metadata
metadata <- read_delim("colombia/metadata_categorized_CL.txt",delim = "\t",escape_double = FALSE,trim_ws = TRUE)
#isolate smoking and nonsmoking from abundance data and metadata
metadata_smoking <- filter(metadata, metadata$smoker=="Yes")
metadata_nonsmoking <- filter(metadata, metadata$smoker=="No")
abundance_data_smoking <- select(abundance_data, metadata_smoking$`#SampleID`)
abundance_data_nonsmoking <- select(abundance_data, metadata_nonsmoking$`#SampleID`)
# abundance_data_smoking <- cbind(abundance_data$pathway,select(abundance_data, metadata_smoking$`#SampleID`))
# abundance_data_nonsmoking <- cbind(abundance_data$pathway,select(abundance_data, metadata_nonsmoking$`#SampleID`))
# names(abundance_data_smoking)[names(abundance_data_smoking) == 'abundance_data$pathway'] <- 'pathway'
# names(abundance_data_nonsmoking)[names(abundance_data_nonsmoking) == 'abundance_data$pathway'] <- 'pathway'
# Perform pathway differential abundance analysis (DAA) using LinDA
# This requires
daa_results_df <- pathway_daa(abundance = abundance_data, metadata = metadata,
group = "fibre_category", daa_method = "LinDA", select = NULL, reference = NULL)
daa_results_df_smoking <- pathway_daa(abundance = abundance_data_smoking, metadata = metadata_smoking,
group = "fibre_category", daa_method = "LinDA", select = NULL, reference = NULL)
daa_results_df_nonsmoking <- pathway_daa(abundance = abundance_data_nonsmoking, metadata = metadata_nonsmoking,
group = "fibre_category", daa_method = "LinDA", select = NULL, reference = NULL)
# Generate pathway heatmap
# ISSUE:
feature_with_p_0.1 <- daa_results_df_nonsmoking %>% filter(p_adjust < 0.1)
pathway_heatmap(abundance = abundance_data_smoking %>% filter("PWY" %in% feature_with_p_0.05$feature) %>% column_to_rownames("pathway"), metadata = metadata, group = "fibre_category")
pathway_heatmap(abundance = abundance_data_smoking %>% filter(pathway %in% feature_with_p_0.05$feature) %>% column_to_rownames("pathway"), metadata = metadata, group = "fibre_category")
