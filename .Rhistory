# Load packages
load(vegan)
# Load packages
load(phyloseq)
# Load packages
library(phyloseq)
# Load packages
library(vegan)
library(tidyverse)
load("C:/Users/saman/Desktop/micb475-project2/phyloseq_object_final.RData")
# Load phyloseq object
load(phyloseq_object_final)
# Load phyloseq object
load("phyloseq_object_final.RData:)
# Load phyloseq object
load("phyloseq_object_final.RData")
library(phyloseq)
library(tidyverse)
# Load phyloseq object
load("phyloseq_object_final.RData")
load("colombia_filt_nolow_samps.RData")
# Bray-Curtis
dist_bc <- as.matrix(vegdist(phyloseq_object_final, method = "bray"))
bc_dm <- distance(phyloseq_object_final, method="bray")
# check which methods you can specify
?distance
pcoa_bc <- ordinate(phyloseq_object_final, method="PCoA", distance=bc_dm)
View(pcoa_bc)
View(colombia_filt_nolow_samps)
View(colombia_filt_nolow_samps)
plot_ordination(phyloseq_object_final, pcoa_bc, color = "smoker", shape="fibre_category")
gg_pcoa <- plot_ordination(mpt_rare, pcoa_bc, color = "smoker", shape="fibre_category") +
labs(pch="fibre level", col = "smoking status")
gg_pcoa
gg_pcoa <- plot_ordination(phyloseq_object_final, pcoa_bc, color = "smoker", shape="fibre_category") +
labs(pch="fibre level", col = "smoking status")
gg_pcoa
gg_pcoa_LDL <- plot_ordination(phyloseq_object_final, pcoa_bc, color = "smoker", shape="LDL_category") +
labs(pch="LDL level", col = "smoking status")
gg_pcoa_LDL
gg_pcoa_fibre <- plot_ordination(phyloseq_object_final, pcoa_bc, color = "smoker", shape="fibre_category") +
labs(pch="fibre level", col = "smoking status")
gg_pcoa_fibre
gg_pcoa_LDL
gg_pcoa_fibre
gg_pcoa_LDL
gg_pcoa_fibre
gg_pcoa_LDL
gg_pcoa_fibre
gg_pcoa_LDL
gg_pcoa_fibre
gg_pcoa_LDL
# Save plots
ggsave("plot_pcoa_fibre.png"
, gg_pcoa_fibre
, height=4, width=5)
ggsave("plot_pcoa_LDL.png"
, gg_pcoa_LDL
, height=4, width=5)
plot_ordination(phyloseq_object_final, pcoa_bc, color = "fibre_category", shape="smoker")
plot_ordination(phyloseq_object_final, pcoa_bc, color = "LDL_category", shape="smoker")
plot_ordination(phyloseq_object_final, pcoa_bc, color = "LDL_category", shape="smoker")
plot_ordination(phyloseq_object_final, pcoa_bc, color = "fibre_category", shape="smoker")
plot_ordination(phyloseq_object_final, pcoa_bc, color = "fibre_category", shape="smoker")
plot_ordination(phyloseq_object_final, pcoa_bc, color = "LDL_category", shape="smoker")
gg_pcoa_fibre <- plot_ordination(phyloseq_object_final, pcoa_bc, color = "fibre_category", shape="smoker") +
labs(pch="smoking status", col = "fibre level")
gg_pcoa_fibre
plot_ordination(phyloseq_object_final, pcoa_bc, color = "fibre_category", shape="smoker")
gg_pcoa_fibre <- plot_ordination(phyloseq_object_final, pcoa_bc, color = "fibre_category", shape="smoker") +
labs(pch="smoking status", col = "fibre level")
gg_pcoa_fibre
gg_pcoa_LDL <- plot_ordination(phyloseq_object_final, pcoa_bc, color = "LDL_category", shape="smoker") +
labs(pch="smoking status", col = "LDL level")
gg_pcoa_LDL
# Save plots
ggsave("plot_pcoa_fibre.png"
, gg_pcoa_fibre
, height=4, width=5)
ggsave("plot_pcoa_LDL.png"
, gg_pcoa_LDL
, height=4, width=5)
#load libraries
library(phyloseq)
library(ape)
library(tidyverse)
library(vegan)
#load data
metafp <- "colombia/metadata_categorized_CL.txt"
meta <- read_delim(metafp, delim="\t")
meta
otufp <- "colombia/colombia_export/table_export/feature-table.txt"
otu <- read_delim(file = otufp, delim="\t", skip=1)
taxfp <- "colombia/colombia_export/taxonomy_export/taxonomy.tsv"
tax <- read_delim(taxfp, delim="\t")
phylotreefp <- "colombia/colombia_export/rooted_tree_export/tree.nwk"
phylotree <- read.tree(phylotreefp)
otu_mat <- as.matrix(otu[,-1])
rownames(otu_mat) <- otu$`#OTU ID`
OTU <- otu_table(otu_mat, taxa_are_rows = TRUE)
class(OTU)
### Format updated metadata ###
samp_df <- as.data.frame(meta[,-1])
rownames(samp_df)<- meta$'#SampleID'
SAMP <- sample_data(samp_df)
class(SAMP)
### Formatting taxonomy ###
tax_mat <- tax %>% select(-Confidence)%>%
separate(col=Taxon, sep="; "
, into = c("Domain","Phylum","Class","Order","Family","Genus","Species")) %>%
as.matrix()
tax_mat <- tax_mat[,-1]
rownames(tax_mat) <- tax$`Feature ID`
TAX <- tax_table(tax_mat)
class(TAX)
### Create phyloseq object ###
colombia <- phyloseq(OTU, SAMP, TAX, phylotree)
### Looking at phyloseq object ####
otu_table(colombia)
sample_data(colombia)
tax_table(colombia)
phy_tree(colombia)
### Filter out non-bacterial sequences ###
colombia_filt <- subset_taxa(colombia, Domain == "d__Bacteria" & Class!="c__Chloroplast" & Family !="f__Mitochondria")
### Pruning samples with less than 100 reads ###
colombia_filt_samps <- prune_samples(sample_sums(colombia_filt)>100, colombia_filt)
### Rarefy ###
phyloseq_object_final <- rarefy_even_depth(colombia_filt_samps, rngseed = 1, sample.size = 22700)
### Save ###
save(colombia_filt_samps, file="colombia_filt_samps.RData")
save(phyloseq_object_final, file="phyloseq_object_final.RData")
# Load packages
library(vegan)
library(phyloseq)
library(tidyverse)
# Load phyloseq object
load("phyloseq_object_final.RData")
# PCoA Plot
bc_dm <- distance(phyloseq_object_final, method="bray")
pcoa_bc <- ordinate(phyloseq_object_final, method="PCoA", distance=bc_dm)
plot_ordination(phyloseq_object_final, pcoa_bc, color = "fibre_category", shape="smoker")
abundance_file <- "pricrust_processing/picrust2_out_pipeline/pathways_out/path_abun_unstrat.tsv"
abundance_data <- read_delim(abundance_file, delim = "\t", col_names = TRUE, trim_ws = TRUE)
abundance_data  =as.data.frame(abundance_data)
abundance_data <- read_delim(abundance_file, delim = "\t", col_names = TRUE, trim_ws = TRUE)
library(readr)
library(ggpicrust2)
library(tibble)
library(tidyverse)
library(ggprism)
library(patchwork)
library()
abundance_data <- read_delim(abundance_file, delim = "\t", col_names = TRUE, trim_ws = TRUE)
abundance_file <- "/pricrust_processing/picrust2_out_pipeline/pathways_out/path_abun_unstrat.tsv"
abundance_data <- read_delim(abundance_file, delim = "\t", col_names = TRUE, trim_ws = TRUE)
abundance_file <- "micb475-project2/picrust processing/picrust2_out_pipeline/pathways_out/path_abun_unstrat.tsv.gz"
abundance_data <- read_delim(abundance_file, delim = "\t", col_names = TRUE, trim_ws = TRUE)
abundance_file <- "picrust processing/picrust2_out_pipeline/pathways_out/path_abun_unstrat.tsv.gz"
abundance_data <- read_delim(abundance_file, delim = "\t", col_names = TRUE, trim_ws = TRUE)
abundance_data  =as.data.frame(abundance_data)
rownames(abundance_data) = abundance_data$pathway
abundance_data = abundance_data[,-1]
metadata <- read_delim(
"colombia/metadata_categorized_CL.txt",
delim = "\t",
escape_double = FALSE,
trim_ws = TRUE
)
samples = colnames()
samples = col_names()
results_file_input <- ggpicrust2(file = abundance_data,
metadata = metadata,
group = "smoker", # For example dataset, group = "Environment"
pathway = "MetaCyc",
daa_method = "LinDA",
ko_to_kegg = FALSE,
order = "pathway_class",
p_values_bar = TRUE,
x_lab = "pathway_name")
