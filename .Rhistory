# Please change column_to_rownames() to the feature column if you are not using example dataset
# Please change group to "your_group_column" if you are not using example dataset
methods <- c("DESeq2", "edgeR") #"ALDEx2"
daa_results_list <- lapply(methods, function(method) {
pathway_daa(abundance = abundance_data %>% column_to_rownames("pathway"), metadata = metadata, group = "smoker", daa_method = method)
})
### Perform pathway differential abundance analysis (DAA) using LinDA method ###
daa_results_df <- pathway_daa(abundance = abundance_data %>% column_to_rownames("pathway"),
metadata = metadata,
group = "smoker",
daa_method = "LinDA",
select = NULL, reference = NULL)
daa_results_df_smoking <- pathway_daa(abundance = abundance_data_smoking%>% column_to_rownames("pathway"),
metadata = metadata_smoking,
group = "fibre_category",
daa_method = "LinDA",
select = NULL, reference = NULL)
daa_results_df_nonsmoking <- pathway_daa(abundance = abundance_data_nonsmoking %>% column_to_rownames("pathway"),
metadata = metadata_nonsmoking,
group = "fibre_category",
daa_method = "LinDA",
select = NULL, reference = NULL)
# ALDEx2 method
daa_results_df <- pathway_daa(abundance = abundance_data %>% column_to_rownames("pathway"),
metadata = metadata,
group = "smoker",
daa_method = "ALDEx2",
select = NULL, reference = NULL)
library(ALDEx2)
if (!requireNamespace("BiocManager", quietly = TRUE))
#### Nov 7, 2023 - SKA ####
#!/usr/bin/env Rscript
pkgs <- c("phyloseq", "ALDEx2", "SummarizedExperiment", "Biobase", "devtools",
"ComplexHeatmap", "BiocGenerics", "BiocManager", "metagenomeSeq",
"Maaslin2", "edgeR", "lefser", "limma", "KEGGREST", "DESeq2")
for (pkg in pkgs) {
if (!requireNamespace(pkg, quietly = TRUE))
BiocManager::install(pkg)
}
#### Nov 7, 2023 - SKA ####
#!/usr/bin/env Rscript
pkgs <- c("phyloseq", "ALDEx2", "SummarizedExperiment", "Biobase", "devtools",
"ComplexHeatmap", "BiocGenerics", "BiocManager", "metagenomeSeq",
"Maaslin2", "edgeR", "lefser", "limma", "KEGGREST", "DESeq2")
for (pkg in pkgs) {
if (!requireNamespace(pkg, quietly = TRUE))
BiocManager::install(pkg)
}
library(ALDEx2)
library(edgeR)
library(DESeq2)
### Run pathway DAA for multiple methods ###
# Please change column_to_rownames() to the feature column if you are not using example dataset
# Please change group to "your_group_column" if you are not using example dataset
methods <- c("ALDEx2", "DESeq2", "edgeR") #"ALDEx2"
daa_results_list <- lapply(methods, function(method) {
pathway_daa(abundance = abundance_data %>% column_to_rownames("pathway"), metadata = metadata, group = "smoker", daa_method = method)
})
View(daa_results_list)
### Perform pathway differential abundance analysis (DAA) ###
# LinDA method
daa_results_df <- pathway_daa(abundance = abundance_data %>% column_to_rownames("pathway"),
metadata = metadata,
group = "smoker",
daa_method = "LinDA",
select = NULL, reference = NULL)
daa_results_df_smoking_fibre <- pathway_daa(abundance = abundance_data_smoking%>% column_to_rownames("pathway"), metadata = metadata_smoking, group = "fibre_category", daa_method = "LinDA", select = NULL, reference = NULL)
daa_results_df_nonsmoking_fibre <- pathway_daa(abundance = abundance_data_nonsmoking %>% column_to_rownames("pathway"), metadata = metadata_nonsmoking, group = "fibre_category", daa_method = "LinDA", select = NULL, reference = NULL)
daa_results_df_smoking_LDL <- pathway_daa(abundance = abundance_data_smoking%>% column_to_rownames("pathway"), metadata = metadata_smoking, group = "LDL_category", daa_method = "LinDA", select = NULL, reference = NULL)
daa_results_df_nonsmoking_LDL <- pathway_daa(abundance = abundance_data_nonsmoking %>% column_to_rownames("pathway"), metadata = metadata_nonsmoking, group = "LDL_category", daa_method = "LinDA", select = NULL, reference = NULL)
daa_results_list_smoking_fibre <- lapply(methods, function(method) {
pathway_daa(abundance = abundance_data_smoking %>% column_to_rownames("pathway"), metadata = metadata, group = "fibre_category", daa_method = method)
})
daa_results_list_nonsmoking_fibre <- lapply(methods, function(method) {
pathway_daa(abundance = abundance_data_nonsmoking %>% column_to_rownames("pathway"), metadata = metadata, group = "fibre_category", daa_method = method)
})
daa_results_list_smoking_LDL <- lapply(methods, function(method) {
pathway_daa(abundance = abundance_data_smoking %>% column_to_rownames("pathway"), metadata = metadata, group = "LDL_category", daa_method = method)
})
daa_results_list_nonsmoking_LDL <- lapply(methods, function(method) {
pathway_daa(abundance = abundance_data_nonsmoking %>% column_to_rownames("pathway"), metadata = metadata, group = "LDL_category", daa_method = method)
})
print(daa_results_list)
print(daa_results_list$[[1]])
print(daa_results_list$1)
print(daa_results_list[[1]])
sig_feature_list <- lapply(daa_results_list, function(results_list) {
results_list %>% filter(p_values < 0.05)
})
View(sig_feature_list)
### Generate pathway heatmap using multiple methods###
# smokers only
# feature_with_p_0.05 <- daa_results_df %>% filter(p_values < 0.05)
sig_feature_list <- lapply(daa_results_list, function(results) {
results %>% filter(p_values < 0.05)
})
### Generate pathway heatmap using multiple methods###
# smokers only
# feature_with_p_0.05 <- daa_results_df %>% filter(p_values < 0.05)
sig_feature_list <- lapply(daa_results_list, function(results) {
results %>% filter(p_values < 0.05)
})
heatmap_list_smoker <- lapply(sig_feature_list, function(sig) {
pathway_heatmap(abundance = abundance_data %>% filter(pathway %in% sig$feature) %>% column_to_rownames("pathway"), metadata = metadata, group = "smoker")
})
View(heatmap_list_smoker)
heatmap_list_smoker[[1]]
heatmap_ALDEx2_smoker <- heatmap_list_smoker[[1]]
heatmap_ALDEx2_smoker
heatmap_DESeq2_smoker <- heatmap_list_smoker[[2]]
heatmap_edgeR_smoker <- heatmap_list_smoker[[3]]
heatmap_edgeR_smoker
heatmap_ALDEx2_smoker
heatmap_DESeq2_smoker
heatmap_edgeR_smoker
## smoking-fibre
sig_feature_list_smoking_fibre <- lapply(daa_results_list_smoking_fibre, function(results) {
results %>% filter(p_values < 0.05)
})
heatmap_list_smoking_fibre <- lapply(sig_feature_list_smoking_fibre, function(sig) {
pathway_heatmap(abundance = abundance_data %>% filter(pathway %in% sig$feature) %>% column_to_rownames("pathway"), metadata = metadata, group = "smoker")
})
heatmap_ALDEx2_smoking_fibre <- heatmap_list_smoking_fibre[[1]]
heatmap_DESeq2_smoking_fibre <- heatmap_list_smoking_fibre[[2]]
heatmap_edgeR_smoking_fibre <- heatmap_list_smoking_fibre[[3]]
heatmap_ALDEx2_smoking_fibre
heatmap_DESeq2_smoking_fibre
heatmap_edgeR_smoking_fibre
View(metadata_nonsmoking)
View(metadata_smoking)
### Read abundance data
abundance_file <- "picrust_processing/picrust2_out_pipeline/pathways_out/path_abun_unstrat.tsv"
abundance_data <- read_delim(abundance_file, delim = "\t", col_names = TRUE, trim_ws = TRUE) %>% as.data.frame()
### Read metadata
metadata <- read_delim("colombia/metadata_categorized_CL.txt",delim = "\t",escape_double = FALSE,trim_ws = TRUE)
### Isolate smoking and nonsmoking from abundance data and metadata
metadata_smoking <- filter(metadata, metadata$smoker=="Yes")
metadata_nonsmoking <- filter(metadata, metadata$smoker=="No")
abundance_data_smoking <- select(abundance_data, metadata_smoking$`#SampleID`)
abundance_data_smoking$pathway = abundance_data$pathway
abundance_data_smoking <- abundance_data_smoking %>% select(pathway, everything())
abundance_data_nonsmoking <- select(abundance_data, metadata_nonsmoking$`#SampleID`)
abundance_data_smoking <- select(abundance_data, metadata_smoking$`#SampleID`)
#!/bin/R
#From picrust2 analysis, produces heatmaps of pathways signififantly (p<0.05 up or downregulated)
#in smoking and nonsmoking adults, displaying their fiber consumption (high or low)
library(readr)
library(ggpicrust2)
library(tibble)
library(tidyverse)
library(ggprism)
library(patchwork)
library(ggh4x)
#read abundance data
abundance_file <- "picrust_processing/picrust2_out_pipeline/pathways_out/path_abun_unstrat.tsv"
abundance_data <- read_delim(abundance_file, delim = "\t", col_names = TRUE, trim_ws = TRUE) %>% as.data.frame()
#read metadata
metadata <- read_delim("colombia/metadata_categorized_CL.txt",delim = "\t",escape_double = FALSE,trim_ws = TRUE)
#isolate smoking and nonsmoking from abundance data and metadata
metadata_smoking <- filter(metadata, metadata$smoker=="Yes")
metadata_nonsmoking <- filter(metadata, metadata$smoker=="No")
abundance_data_smoking <- select(abundance_data, metadata_smoking$`#SampleID`)
abundance_data_smoking <- select(abundance_data, metadata_smoking$"#SampleID")
abundance_data_smoking <- select(abundance_data, metadata_smoking$"#SampleID"=="Yes")
daa_results_df_smoking_fibre <- pathway_daa(abundance = abundance_data_smoking%>% column_to_rownames("pathway"), metadata = metadata_smoking, group = "fibre_category", daa_method = "LinDA", select = NULL, reference = NULL)
View(abundance_data)
abundance_data_smoking <- select(abundance_data, metadata_smoking$`#SampleID`)
### Load packages
library(ggpicrust2)
library(tibble)
library(tidyverse)
library(ggprism)
library(patchwork)
library(ggh4x)
library(ALDEx2)
library(edgeR)
library(DESeq2)
### Read abundance data
abundance_file <- "picrust_processing/picrust2_out_pipeline/pathways_out/path_abun_unstrat.tsv"
abundance_data <- read_delim(abundance_file, delim = "\t", col_names = TRUE, trim_ws = TRUE) %>% as.data.frame()
### Read metadata
metadata <- read_delim("colombia/metadata_categorized_CL.txt",delim = "\t",escape_double = FALSE,trim_ws = TRUE)
### Isolate smoking and nonsmoking from abundance data and metadata
metadata_smoking <- filter(metadata, metadata$smoker=="Yes")
metadata_nonsmoking <- filter(metadata, metadata$smoker=="No")
abundance_data_smoking <- select(abundance_data, metadata_smoking$`#SampleID`)
abundance_data_smoking <- select(abundance_data, rownames(metadata_smoking$`#SampleID`))
library(dplyr)
abundance_data_smoking <- select(abundance_data, metadata_smoking$`#SampleID`)
abundance_data_smoking <- abundance_data %>% select(metadata_smoking$`#SampleID`)
abundance_data_smoking <- abundance_data %>% select(metadata_smoking$`#SampleID`)
abundance_data_smoking <- select(abundance_data, metadata_smoking$`#SampleID`)
abundance_data_smoking$pathway = abundance_data$pathway
abundance_data_smoking <- select(abundance_data, metadata_smoking$`#SampleID`)
abundance_data_smoking$pathway = abundance_data$pathway
abundance_data_smoking <- abundance_data_smoking %>% select(pathway, everything())
library(dplyr)
### Read abundance data
abundance_file <- "picrust_processing/picrust2_out_pipeline/pathways_out/path_abun_unstrat.tsv"
abundance_data <- read_delim(abundance_file, delim = "\t", col_names = TRUE, trim_ws = TRUE) %>% as.data.frame()
### Read metadata
metadata <- read_delim("colombia/metadata_categorized_CL.txt",delim = "\t",escape_double = FALSE,trim_ws = TRUE)
### Isolate smoking and nonsmoking from abundance data and metadata
metadata_smoking <- filter(metadata, metadata$smoker=="Yes")
metadata_nonsmoking <- filter(metadata, metadata$smoker=="No")
abundance_data_smoking <- select(abundance_data, metadata_smoking$`#SampleID`)
.libPaths()
#!/bin/R
#PURPOSE: From picrust2 analysis, produces PCA plots for smokers and nonsmokers
library(ggpicrust2)
library(tibble)
library(tidyverse)
library(ggprism)
library(patchwork)
library(ggh4x)
install.packages("ggpicrust2")
### Load packages
library(ggpicrust2)
# Load packages
library(vegan)
library(phyloseq)
library(tidyverse)
pkgs <- c("phyloseq", "ALDEx2", "edgeR", "DESeq2")
for (pkg in pkgs) {
if (!requireNamespace(pkg, quietly = TRUE))
BiocManager::install(pkg)
}
install.packages("ggpicrust2")
devtools::install_github("cafferychen777/ggpicrust2")
install.packages("devtools")
devtools::install_github("cafferychen777/ggpicrust2")
### Load packages
library(ggpicrust2)
library(readr)
library(ggpicrust2)
install.packages("ggpicrust2")
install.packages("ggpicrust2")
# Load packages
library(vegan)
library(phyloseq)
library(tidyverse)
install.packages("ggpicrust2")
### Load packages
library(ggpicrust2)
library(tibble)
library(tidyverse)
# Load phyloseq object
load("phyloseq_object_final.RData")
samp_dat_wdiv <- data.frame(sample_data(phyloseq_object_final), estimate_richness(phyloseq_object_final))
#Making a new column in the metadata to combined fibre and smoking
sample_data(phyloseq_object_final)[[40]] = paste(sample_data(phyloseq_object_final)[[32]],sample_data(phyloseq_object_final)[[38]])
#Making a new column in the metadata to combined LDL and smoking
sample_data(phyloseq_object_final)[[41]] = paste(sample_data(phyloseq_object_final)[[32]],sample_data(phyloseq_object_final)[[37]])
### PERMANOVA (Permutational ANOVA) ####
# Use phyloseq to calculate distance matrix
dm_weighted_unifrac <- UniFrac(phyloseq_object_final, weighted=TRUE)#weighted unifrac
install.packages("ggpicrust2")
install.packages("ggpicrust2")
.libPaths()
library(tibble)
library(tidyverse)
library(ggprism)
library(patchwork)
library(ggh4x)
library(ALDEx2)
library(edgeR)
library(DESeq2)
library(dplyr)
### Read abundance data
abundance_file <- "picrust_processing/picrust2_out_pipeline/pathways_out/path_abun_unstrat.tsv"
abundance_data <- read_delim(abundance_file, delim = "\t", col_names = TRUE, trim_ws = TRUE) %>% as.data.frame()
### Read metadata
metadata <- read_delim("colombia/metadata_categorized_CL.txt",delim = "\t",escape_double = FALSE,trim_ws = TRUE)
### Isolate smoking and nonsmoking from abundance data and metadata
metadata_smoking <- filter(metadata, metadata$smoker=="Yes")
metadata_nonsmoking <- filter(metadata, metadata$smoker=="No")
abundance_data_smoking <- select(abundance_data, metadata_smoking$`#SampleID`)
View(abundance_data_nonsmoking)
View(abundance_data_smoking)
install.packages("ggpicrust2")
BiocManager::install(c(
"ALDEx2", "DESeq2", "edgeR", "limma", "Maaslin2", "metagenomeSeq",
"SummarizedExperiment", "phyloseq", "biomformat", "lefser"
))
install.packages("MicrobiomeStat")
install.packages("ggpicrust2")
install.packages("ggfun")
install.packages("aplot")
install.packages("ggpicrust2")
install.packages("ggpicrust2")
install.packages("ggpicrust2")
### Load packages
library(ggpicrust2)
library(tibble)
library(tidyverse)
library(ggprism)
library(patchwork)
library(ggh4x)
library(ALDEx2)
library(edgeR)
library(DESeq2)
daa_results_df_smoking_fibre <- pathway_daa(abundance = abundance_data_smoking%>% column_to_rownames("pathway"), metadata = metadata_smoking, group = "fibre_category", daa_method = "LinDA", select = NULL, reference = NULL)
### Perform pathway differential abundance analysis (DAA) ###
## LinDA method
daa_results_df <- pathway_daa(abundance = abundance_data %>% column_to_rownames("pathway"),
metadata = metadata,
group = "smoker",
daa_method = "LinDA",
select = NULL, reference = NULL)
install.packages("ggpicrust2")
library(readr)
library(ggpicrust2)
# load packages
library(readr)
library(ggpicrust2)
library(tibble)
library(tidyverse)
library(ggprism)
library(patchwork)
library(ggh4x)
### load abundance data ###
abundance_file <- "picrust_processing/picrust2_out_pipeline/pathways_out/path_abun_unstrat.tsv.gz"
abundance_data <- read_delim(abundance_file, delim = "\t", col_names = TRUE, trim_ws = TRUE) %>% as.data.frame()
#abundance_data$pathway = rownames(abundance_data)
#abundance_data = abundance_data[,-1]
### load metadata ###
metadata <- read_delim("colombia/metadata_categorized_CL.txt",
delim = "\t",
escape_double = FALSE,
trim_ws = TRUE)
### Perform pathway differential abundance analysis (DAA) using LinDA method ###
daa_results_df <- pathway_daa(abundance = abundance_data %>% column_to_rownames("pathway"),
metadata = metadata,
group = "smoker",
daa_method = "LinDA",
select = NULL, reference = NULL)
install.packages("ggpicrust2")
install.packages("ggpicrust2", dependencies = TRUE)
install.packages("ggpicrust2")
install.packages("dplyr")
install.packages("ggplotify")
install.packages("cowplot")
install.packages("MicrobiomeStat")
install.packages("aplot")
install.packages("ggpicrust2")
devtools::install_github('cafferychen777/ggpicrust2')
install.packages("devtools")
devtools::install_github('cafferychen777/ggpicrust2')
BiocManager::install(c(
"ALDEx2", "DESeq2", "edgeR", "limma", "Maaslin2", "metagenomeSeq",
"SummarizedExperiment", "phyloseq", "biomformat", "lefser"
))
devtools::install_github('cafferychen777/ggpicrust2')
# load packages
library(readr)
library(ggpicrust2)
library(tibble)
library(tidyverse)
library(ggprism)
library(patchwork)
library(ggh4x)
### load abundance data ###
abundance_file <- "picrust_processing/picrust2_out_pipeline/pathways_out/path_abun_unstrat.tsv.gz"
abundance_data <- read_delim(abundance_file, delim = "\t", col_names = TRUE, trim_ws = TRUE) %>% as.data.frame()
#abundance_data$pathway = rownames(abundance_data)
#abundance_data = abundance_data[,-1]
### load metadata ###
metadata <- read_delim("colombia/metadata_categorized_CL.txt",
delim = "\t",
escape_double = FALSE,
trim_ws = TRUE)
### Perform pathway differential abundance analysis (DAA) using LinDA method ###
daa_results_df <- pathway_daa(abundance = abundance_data %>% column_to_rownames("pathway"),
metadata = metadata,
group = "smoker",
daa_method = "LinDA",
select = NULL, reference = NULL)
### Generate pathway heatmap ###
feature_with_p_0.05 <- daa_results_df %>% filter(p_values < 0.05)
heatmap_smoker <- pathway_heatmap(abundance = abundance_data %>% filter(pathway %in% feature_with_p_0.05$feature) %>% column_to_rownames("pathway"), metadata = metadata, group = "smoker")
### Generate pathway PCA plot ###
pca_plot_smoker <- pathway_pca(abundance = abundance_data %>% column_to_rownames("pathway"), metadata = metadata, group = "smoker")+ggtitle("PCA plot comparing smoking in all participants")
# pca_plot_smoker
pca_plot_LDL <- pathway_pca(abundance = abundance_data %>% column_to_rownames("pathway"), metadata = metadata, group = "LDL_category")+ggtitle("PCA plot comparing LDL in all participants")
### Load packages
library(ggpicrust2)
library(tibble)
library(tidyverse)
library(ggprism)
library(patchwork)
library(ggh4x)
library(ALDEx2)
library(edgeR)
library(DESeq2)
### Read abundance data
abundance_file <- "picrust_processing/picrust2_out_pipeline/pathways_out/path_abun_unstrat.tsv"
abundance_data <- read_delim(abundance_file, delim = "\t", col_names = TRUE, trim_ws = TRUE) %>% as.data.frame()
### Read metadata
metadata <- read_delim("colombia/metadata_categorized_CL.txt",delim = "\t",escape_double = FALSE,trim_ws = TRUE)
### Isolate smoking and nonsmoking from abundance data and metadata
metadata_smoking <- filter(metadata, metadata$smoker=="Yes")
metadata_nonsmoking <- filter(metadata, metadata$smoker=="No")
abundance_data_smoking <- select(abundance_data, metadata_smoking$`#SampleID`)
abundance_data_smoking <- "picrust_processing/imogen_picrust_tests/abundance_smoking.tsv"
abundance_data_smoking$pathway = abundance_data$pathway
abundance_data_smoking <- abundance_data_smoking %>% select(pathway, everything())
View(abundance_data_smoking)
### Isolate smoking and nonsmoking from abundance data and metadata
metadata_smoking <- filter(metadata, metadata$smoker=="Yes")
metadata_nonsmoking <- filter(metadata, metadata$smoker=="No")
### Perform pathway differential abundance analysis (DAA) ###
## LinDA method
daa_results_df <- pathway_daa(abundance = abundance_data %>% column_to_rownames("pathway"),
metadata = metadata,
group = "smoker",
daa_method = "LinDA",
select = NULL, reference = NULL)
## Multiple methods: ALDEx2, DESeq2, edgeR
methods <- c("ALDEx2", "DESeq2", "edgeR") #"ALDEx2"
daa_results_list <- lapply(methods, function(method) {
pathway_daa(abundance = abundance_data %>% column_to_rownames("pathway"), metadata = metadata, group = "smoker", daa_method = method)
}) # smoker only
View(daa_results_df)
### Read metadata
metadata <- read_delim("colombia/metadata_categorized_CL.txt",delim = "\t",escape_double = FALSE,trim_ws = TRUE)
## Multiple methods: ALDEx2, DESeq2, edgeR
methods <- c("ALDEx2", "DESeq2", "edgeR") #"ALDEx2"
## Multiple methods: ALDEx2, DESeq2, edgeR
methods <- c("ALDEx2", "DESeq2", "edgeR") #"ALDEx2"
daa_results_list <- lapply(methods, function(method) {
pathway_daa(abundance = abundance_data %>% column_to_rownames("pathway"), metadata = metadata, group = "smoker", daa_method = method)
}) # smoker only
### Generate pathway heatmap using multiple methods###
## smokers only
sig_feature_list <- lapply(daa_results_list, function(results) {
results %>% filter(p_values < 0.05)
})
### Load packages
library(ggpicrust2)
library(tibble)
library(tidyverse)
library(ggprism)
library(patchwork)
library(ggh4x)
library(ALDEx2)
library(edgeR)
library(DESeq2)
View(metadata_smoking)
# load packages
library(readr)
library(ggpicrust2)
library(tibble)
library(tidyverse)
library(ggprism)
library(patchwork)
library(ggh4x)
library(ALDEx2)
library(DESeq2)
library(edgeR)
### load abundance data ###
abundance_file <- "picrust_processing/picrust2_out_pipeline/pathways_out/path_abun_unstrat.tsv.gz"
abundance_data <- read_delim(abundance_file, delim = "\t", col_names = TRUE, trim_ws = TRUE) %>% as.data.frame()
#abundance_data$pathway = rownames(abundance_data)
#abundance_data = abundance_data[,-1]
### load metadata ###
metadata <- read_delim("colombia/metadata_categorized_CL.txt",
delim = "\t",
escape_double = FALSE,
trim_ws = TRUE)
# Run pathway DAA for multiple methods
# Please change column_to_rownames() to the feature column if you are not using example dataset
# Please change group to "your_group_column" if you are not using example dataset
methods <- c("ALDEx2", "DESeq2", "edgeR") #"ALDEx2"
daa_results_list <- lapply(methods, function(method) {
pathway_daa(abundance = abundance_data %>% column_to_rownames("pathway"), metadata = metadata, group = "smoker", daa_method = method)
})
View(abundance_data)
abundance_data_smoking <- select(abundance_data, metadata_smoking %>% column_to_rownames("#SampleID"))
mtcars %>%
dplyr::select(cyl, mpg) %>%
group_by(cyl) %>%
summarize(avg_mpg = mean(mpg))
abundance_data_smoking <- dplyr::select(abundance_data, metadata_smoking$`#SampleID`)
abundance_data_smoking$pathway = abundance_data$pathway
abundance_data_smoking <- abundance_data_smoking %>% select(pathway, everything())
abundance_data_smoking <- abundance_data_smoking %>% dplyr::select(pathway, everything())
abundance_data_nonsmoking <- dplyr::select(abundance_data, metadata_nonsmoking$`#SampleID`)
abundance_data_nonsmoking$pathway = abundance_data$pathway
abundance_data_nonsmoking <- abundance_data_nonsmoking %>% dplyr::select(pathway, everything())
### Filter data to remove 0 standard deviation
row_sds_nonsmok <- abundance_data_nonsmoking %>% column_to_rownames("pathway") %>% apply(1, sd)
filtered_LDL_nonsmok <- abundance_data_nonsmoking[row_sds_nonsmok != 0, ]
row.names(filtered_LDL_nonsmok) <- NULL
row_sds_smok <- abundance_data_smoking %>% column_to_rownames("pathway") %>% apply(1, sd)
filtered_LDL_smok <- abundance_data_smoking[row_sds_smok != 0, ]
row.names(filtered_LDL_smok) <- NULL
### Perform pathway differential abundance analysis (DAA) ###
## LinDA method
daa_results_df <- pathway_daa(abundance = abundance_data %>% column_to_rownames("pathway"),
metadata = metadata,
group = "smoker",
daa_method = "LinDA",
select = NULL, reference = NULL)
daa_results_df_smoking_fibre <- pathway_daa(abundance = abundance_data_smoking%>% column_to_rownames("pathway"), metadata = metadata_smoking, group = "fibre_category", daa_method = "LinDA", select = NULL, reference = NULL)
daa_results_df_nonsmoking_fibre <- pathway_daa(abundance = abundance_data_nonsmoking %>% column_to_rownames("pathway"), metadata = metadata_nonsmoking, group = "fibre_category", daa_method = "LinDA", select = NULL, reference = NULL)
daa_results_df_smoking_LDL <- pathway_daa(abundance = abundance_data_smoking%>% column_to_rownames("pathway"), metadata = metadata_smoking, group = "LDL_category", daa_method = "LinDA", select = NULL, reference = NULL)
daa_results_df_nonsmoking_LDL <- pathway_daa(abundance = abundance_data_nonsmoking %>% column_to_rownames("pathway"), metadata = metadata_nonsmoking, group = "LDL_category", daa_method = "LinDA", select = NULL, reference = NULL)
## Multiple methods: ALDEx2, DESeq2, edgeR
methods <- c("ALDEx2", "DESeq2", "edgeR") #"ALDEx2"
daa_results_list <- lapply(methods, function(method) {
pathway_daa(abundance = abundance_data %>% column_to_rownames("pathway"), metadata = metadata, group = "smoker", daa_method = method)
}) # smoker only
